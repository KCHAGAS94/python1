<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Tarefas</title>
    <style>
        body { font-family: sans-serif; background-color: #f4f4f9; color: #333; margin: 0; padding: 20px; }
        h1, h2 { text-align: center; color: #444; }
        .container { display: flex; justify-content: space-around; gap: 20px; flex-wrap: wrap; }
        .column { background-color: #e9e9f3; border-radius: 8px; padding: 15px; width: 30%; min-width: 300px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .column h3 { border-bottom: 2px solid #ccc; padding-bottom: 10px; text-align: center; }
        .task { background-color: #fff; border: 1px solid #ddd; border-left-width: 5px; padding: 15px; margin-bottom: 10px; border-radius: 5px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .task-header { display: flex; justify-content: space-between; align-items: center; }
        .task-title { font-weight: bold; }
        .task-dates { font-size: 0.8em; color: #666; margin-top: 5px; }
        .task-notes { font-size: 0.9em; margin-top: 10px; word-wrap: break-word; }
        .task-actions { margin-top: 10px; text-align: right; }
        .task-actions a, .task-actions button { text-decoration: none; color: #007bff; background: none; border: none; cursor: pointer; font-size: 0.9em; margin-left: 10px; padding: 5px; }
        .task-actions button { color: #dc3545; }

        .task-move-actions {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #eee;
            text-align: right;
        }
        .task-move-actions form {
            margin-left: 5px;
        }
        .task-move-actions button {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
        }
        .task-move-actions button:hover {
            background-color: #5a6268;
        }

        .add-task-form { background-color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 95%; margin-left: auto; margin-right: auto; }
        .add-task-form input, .add-task-form select, .add-task-form textarea { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .add-task-form button { background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-size: 1em; }
        .priority-urgente { border-left-color: #dc3545; }
        .priority-emergente { border-left-color: #fd7e14; }
        .priority-necessário { border-left-color: #ffc107; }
        .priority-delegavel { border-left-color: #17a2b8; }
        .priority-label { padding: 3px 8px; border-radius: 12px; color: white; font-size: 0.8em; text-transform: capitalize; }
        .label-urgente { background-color: #dc3545; }
        .label-emergente { background-color: #fd7e14; }
        .label-necessário { background-color: #ffc107; }
        .label-delegavel { background-color: #17a2b8; }
    </style>
</head>
<body>
    <h1>Gestor de Tarefas</h1>

    <div class="add-task-form">
        <h2>Adicionar Nova Tarefa</h2>
        <form action="{{ url_for('add_task') }}" method="post">
            <input type="text" name="title" placeholder="Título da Tarefa" required>
            <textarea name="notes" placeholder="Anotações"></textarea>
            <select name="priority">
                {% for p in priorities %}
                <option value="{{ p }}">{{ p.capitalize() }}</option>
                {% endfor %}
            </select>
            <label for="start_date">Início:</label>
            <input type="date" id="start_date" name="start_date">
            <label for="end_date">Fim:</label>
            <input type="date" id="end_date" name="end_date">
            <button type="submit">Adicionar Tarefa</button>
        </form>
    </div>

    <div class="container">
        {% for column in columns %}
        <div class="column">
            <h3>{{ column }}</h3>
            {% for task in tasks_by_column[column] %}
            <div class="task priority-{{ task.priority }}">
                <div class="task-header">
                    <span class="task-title">{{ task.title }}</span>
                    <span class="priority-label label-{{ task.priority }}">{{ task.priority }}</span>
                </div>
                <div class="task-dates">
                    Início: {{ task.start_date or 'N/D' }} | Fim: {{ task.end_date or 'N/D' }}
                </div>
                {% if task.notes %}
                <div class="task-notes">
                    <strong>Anotações:</strong> {{ task.notes }}
                </div>
                {% endif %}
                <div class="task-actions">
                    <a href="{{ url_for('edit_task', task_id=task.id) }}">Editar</a>
                    <form action="{{ url_for('delete_task', task_id=task.id) }}" method="post" style="display:inline;">
                        <button type="submit" onclick="return confirm('Tem certeza que deseja excluir esta tarefa?');">Excluir</button>
                    </form>
                </div>
                <div class="task-move-actions">
                    <span style="font-size: 0.9em; color: #666; float: left; padding-top: 5px;">Mover para:</span>
                    {% for target_column in columns %}
                        {% if target_column != task.column %}
                            <form action="{{ url_for('move_task', task_id=task.id, new_column=target_column) }}" method="post" style="display:inline;">
                                <button type="submit">{{ target_column }}</button>
                            </form>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <p style="text-align:center; color: #777;">Nenhuma tarefa aqui.</p>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</body>
</html>
